- name: Ensure config directory exists
  ansible.builtin.file:
    path: "{{ config_dir }}"
    state: directory
    owner: root
    group: root
    mode: "0755"
  when: inventory_hostname in groups['masters'] or inventory_hostname in groups['workers'] or inventory_hostname in groups['jumpbox']

- name: Generate admin kubeconfig
  ansible.builtin.template:
    src: admin.kubeconfig.j2
    dest: "{{ config_dir }}/admin.kubeconfig"
    owner: root
    group: root
    mode: "0600"
  when: inventory_hostname in groups['masters'] or inventory_hostname in groups['jumpbox']

- name: Generate kubelet kubeconfig
  ansible.builtin.template:
    src: kubelet.kubeconfig.j2
    dest: "{{ config_dir }}/kubelet.kubeconfig"
    owner: root
    group: root
    mode: "0600"
  when: inventory_hostname in groups['workers']

- name: Generate kube-proxy kubeconfig
  ansible.builtin.template:
    src: kube-proxy.kubeconfig.j2
    dest: "{{ config_dir }}/kube-proxy.kubeconfig"
    owner: root
    group: root
    mode: "0600"
  when: inventory_hostname in groups['workers']
